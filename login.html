<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Awvtsaab's æ¼†ä¹¦ â€” Login</title>

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">

  <style>
    /* ---------- è§†è§‰æ ·å¼ï¼ˆç®€æ´ç‰ˆï¼Œä¿ç•™åŠ¨æ„ŸèƒŒæ™¯ï¼‰ ---------- */
    *{box-sizing:border-box}
    body{
      margin:0;
      min-height:100vh;
      font-family: "Share Tech Mono", monospace, Arial;
      color:#fff;
      display:flex;
      align-items:center;
      justify-content:center;
      background:#000;
      overflow:hidden;
    }

    /* èƒŒæ™¯è§†é¢‘ */
    #bg-video {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      z-index: -2;
      opacity: 0.9;
      filter: brightness(.45) blur(3px);
    }

    /* èƒŒæ™¯é®ç½© */
    body::after{
      content:"";
      position:fixed; inset:0;
      background: linear-gradient(135deg, rgba(0,255,200,0.03), rgba(0,100,255,0.03));
      z-index:-1;
    }

    /* ç™»å½•å¡ç‰‡ */
    .card{
      width:420px;
      max-width:95vw;
      padding:32px;
      border-radius:16px;
      background:rgba(10,10,12,0.4);
      backdrop-filter: blur(10px);
      box-shadow:0 10px 50px rgba(0,0,0,0.6);
      border: 2px solid rgba(0,200,255,0.3);
    }

    /* logo */
    .logo{
      display:flex;
      justify-content:center;
      margin-bottom:16px;
    }
    .logo img{ width:96px; filter: drop-shadow(0 4px 16px rgba(0,180,255,0.15)); }

    h1{ text-align:center; margin:8px 0 20px; font-size:22px; letter-spacing:1px; }

    .field{margin-bottom:12px;}
    input, select {
      width:100%; padding:13px 14px; border-radius:10px; border:none;
      background: rgba(255,255,255,0.08);
      color:#fff; outline:none;
      font-size:15px;
    }
    input::placeholder{ color: rgba(255,255,255,0.6); font-size:14px; }

    /* select å•ç‹¬è®¾ç½® */
    select { 
      background: rgba(0,150,255,0.15);
      color: #fff;
    }

    /* æŒ‰é’® */
    .row{display:flex; gap:10px;}
    .btn{
      display:inline-flex; align-items:center; gap:8px;
      justify-content:center;
      width:100%; padding:13px; border-radius:12px; border:none;
      cursor:pointer; font-weight:600; letter-spacing:0.6px;
      background: linear-gradient(90deg,#00e0ff,#0078ff);
      transition:transform .18s, box-shadow .18s;
      color:#031018;
    }
    .btn:hover{ transform: translateY(-2px); box-shadow:0 10px 32px rgba(0,200,255,0.15); }

    .link-btn{
      width:100%; margin-top:10px; padding:12px; border-radius:12px;
      background:transparent; color:#fff; border:1px solid rgba(255,255,255,0.08);
      cursor:pointer;
    }

    /* æç¤º/çŠ¶æ€ä¿¡æ¯ */
    .status {
      margin-top:14px; padding:12px; border-radius:10px;
      background: rgba(0,0,0,0.5);
      font-size:14px; min-height:38px;
    }
    .status.success{ border-left:4px solid #3be37a; }
    .status.error{ border-left:4px solid #ff6b6b; }

    .hidden{ display:none; }

    /* small / muted */
    .small{ font-size:14px; color:rgba(255,255,255,0.8); text-align:center; margin-top:12px; }
    .muted{ color:rgba(255,255,255,0.65); font-size:13px; }

    /* è¯­è¨€é€‰æ‹©å™¨æ ·å¼ */
    .lang-selector {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-bottom: 20px;
    }
    .lang-btn {
      padding: 8px 16px;
      border-radius: 8px;
      background: rgba(0,150,255,0.15);
      border: 1px solid rgba(0,200,255,0.3);
      color: #fff;
      cursor: pointer;
      transition: all 0.2s;
    }
    .lang-btn:hover {
      background: rgba(0,150,255,0.25);
    }
    .lang-btn.active {
      background: rgba(0,200,255,0.4);
      border-color: #00e0ff;
    }

    /* æ¬¢è¿é¡µé¢æ ·å¼ */
    .welcome-container {
      text-align: center;
    }
    .welcome-icon {
      font-size: 48px;
      margin-bottom: 20px;
      color: #00e0ff;
    }
    .welcome-buttons {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }

    /* responsive */
    @media (max-width:420px){
      .card{ padding:24px; width:90vw; }
      h1{ font-size:20px; }
      input, select{ padding:11px; font-size:14px; }
      .btn{ padding:11px; font-size:14px; }
      .welcome-buttons {
        flex-direction: column;
      }
    }

  </style>
</head>
<body>
  <!-- èƒŒæ™¯è§†é¢‘ -->
  <video id="bg-video" autoplay loop playsinline muted>
    <source src="https://res.cloudinary.com/dpw8l6gk2/video/upload/v1762604942/%E5%A4%A9%E4%BD%BF_gqfffi.mp4" type="video/mp4">
    æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè§†é¢‘æ’­æ”¾ã€‚
  </video>

  <div class="card" role="region" aria-label="ç™»å½•å¡ç‰‡">
    <!-- è¯­è¨€é€‰æ‹©å™¨ -->
    <div class="lang-selector">
      <button class="lang-btn" data-lang="en">English</button>
      <button class="lang-btn" data-lang="zh">ä¸­æ–‡</button>
      <button class="lang-btn" data-lang="mm">á€™á€¼á€”á€ºá€™á€¬</button>
    </div>

    <!-- æ¬¢è¿é¡µé¢ -->
    <div id="welcomeView" class="welcome-container">
      <div class="welcome-icon">
        <i class="fa-solid fa-book"></i>
      </div>
      <h1 id="welcomeTitle">Welcome to Awvtsaab's æ¼†ä¹¦</h1>
      <p class="muted" id="welcomeSubtitle">Please select your preferred language to continue</p>
    </div>

    <div id="authViews" class="hidden">
      <!-- ===== LOGIN VIEW ===== -->
      <div id="loginView">
        <div class="logo"><img src="static/assets/logo.gif" alt="logo"></div>
        <h1 id="loginTitle">Login</h1>

        <div class="field"><input id="loginEmail" type="email" placeholder="Email"></div>
        <div class="field"><input id="loginPassword" type="password" placeholder="Password"></div>

        <button class="btn" id="btnLogin" onclick="login()" aria-live="polite">
          <i class="fa-solid fa-right-to-bracket"></i><span id="btnLoginText">Login</span>
        </button>

        <button class="link-btn" onclick="showSignup()">
          <i class="fa-solid fa-user-plus"></i> <span id="createAccountText">Create account</span>
        </button>

        <div class="small" id="loginFooter">Select a different language above</div>
      </div>

      <!-- ===== SIGNUP VIEW ===== -->
      <div id="signupView" class="hidden">
        <h1 id="signupTitle">Create Account</h1>

        <div class="field"><input id="signupName" type="text" placeholder="Name"></div>
        <div class="field"><input id="signupEmail" type="email" placeholder="Email"></div>
        <div class="field"><input id="signupPassword" type="password" placeholder="Password (min 6)"></div>
        <div class="field"><input id="signupAge" type="number" min="1" placeholder="Age"></div>
        <div class="field">
          <select id="signupGender">
            <option value="">Select Gender</option>
            <option value="male">Male</option><option value="female">Female</option><option value="other">Other</option>
          </select>
        </div>
        <div class="field"><input id="signupPhone" type="tel" placeholder="Phone (optional)"></div>

        <button class="btn" id="btnSignup" onclick="signup()"><i class="fa-solid fa-check"></i> <span id="confirmText">Confirm</span></button>
        <button class="link-btn" onclick="showLogin()"><i class="fa-solid fa-arrow-left"></i> <span id="backToLoginText">Back to login</span></button>
      </div>
    </div>

    <!-- ===== Logged-in Panel ===== -->
    <div id="userView" class="hidden">
      <h1 id="welcomeUserTitle">Welcome</h1>
      <div class="muted" id="userInfo">Loading user...</div>

      <div style="margin-top:12px;" class="row">
        <button class="btn" onclick="continueToApp()"><i class="fa-solid fa-check"></i> <span id="readyText">Ready</span></button>
        <button class="link-btn" onclick="signout()"><i class="fa-solid fa-right-from-bracket"></i> <span id="signoutText">Sign out</span></button>
      </div>
      <div style="margin-top:8px;" class="small">Presence: <strong id="presenceText">â€”</strong></div>
    </div>

    <div id="statusBox" class="status muted">Ready</div>
  </div>

  <!-- Firebase compat libs (easy to integrate with existing code) -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

  <script>
  /*********************** REPLACE THIS WITH YOUR FIREBASE CONFIG ***********************/
      const firebaseConfig = {
      apiKey: "AIzaSyBCIVYd8e5vBeGRz-H12Nj9hd5dyqnZCDI",
      authDomain: "guardiangate-7xkgi.firebaseapp.com",
      databaseURL: "https://guardiangate-7xkgi-default-rtdb.firebaseio.com",
      projectId: "guardiangate-7xkgi",
      storageBucket: "guardiangate-7xkgi.firebasestorage.appspot.com",
      messagingSenderId: "133766737758",
      appId: "1:133766737758:web:38de135254fef4664769cf"
    };
  /***************************************************************************************/

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.database();

  // ---------- èƒŒæ™¯è§†é¢‘å’ŒéŸ³é¢‘æ§åˆ¶ ----------
  const bgVideo = document.getElementById('bg-video');

  // åˆå§‹åŒ–è§†é¢‘æ’­æ”¾
  function initVideo() {
    bgVideo.muted = false; // ç›´æ¥å¯ç”¨å£°éŸ³
    bgVideo.volume = 0.3; // è®¾ç½®é€‚å½“éŸ³é‡
    
    // å°è¯•æ’­æ”¾è§†é¢‘å’ŒéŸ³é¢‘
    bgVideo.play().catch(err => {
      console.log("è§†é¢‘è‡ªåŠ¨æ’­æ”¾è¢«é˜»æ­¢:", err);
      // å¦‚æœè‡ªåŠ¨æ’­æ”¾è¢«é˜»æ­¢ï¼Œç­‰å¾…ç”¨æˆ·äº¤äº’
      document.body.addEventListener('click', () => {
        bgVideo.play().catch(e => console.log("ç”¨æˆ·äº¤äº’åæ’­æ”¾å¤±è´¥:", e));
      }, { once: true });
    });
  }

  // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–è§†é¢‘
  window.addEventListener('load', initVideo);

  // å¤„ç†é¡µé¢å¯è§æ€§å˜åŒ–
  document.addEventListener('visibilitychange', () => {
    if (document.hidden) {
      bgVideo.pause();
    } else {
      bgVideo.play().catch(err => console.log("æ¢å¤æ’­æ”¾å¤±è´¥:", err));
    }
  });

  // ---------- è¯­è¨€ç®¡ç†ç³»ç»Ÿ ----------
  let currentLang = localStorage.getItem('preferredLang') || 'en';

  // å®Œæ•´ç¿»è¯‘å­—å…¸
  const translations = {
    en: {
      welcomeTitle: "Welcome to Awvtsaab's æ¼†ä¹¦",
      welcomeSubtitle: "Please select your preferred language to continue",
      loginTitle: "Login",
      signupTitle: "Create Account",
      btnLoginText: "Login",
      createAccountText: "Create account",
      confirmText: "Confirm",
      backToLoginText: "Back to login",
      welcomeUserTitle: "Welcome",
      readyText: "Ready",
      signoutText: "Sign out",
      loginFooter: "Select a different language above",
      emailPlaceholder: "Email",
      passwordPlaceholder: "Password",
      namePlaceholder: "Name",
      agePlaceholder: "Age",
      phonePlaceholder: "Phone (optional)",
      selectGender: "Select Gender",
      male: "Male",
      female: "Female",
      other: "Other",
      statusReady: "Ready",
      statusLoginSuccess: "Login successful",
      statusSignupSuccess: "Account created successfully",
      statusLoggingIn: "Logging in...",
      statusCreatingAccount: "Creating account...",
      statusSigningOut: "Signing out...",
      statusSignedOut: "Signed out",
      statusEnterCredentials: "Please enter email and password",
      statusFillRequired: "Please fill name, email and password (min 6)",
      statusAuthError: "Authentication error"
    },
    zh: {
      welcomeTitle: "æ¬¢è¿æ¥åˆ° Awvtsaab's æ¼†ä¹¦",
      welcomeSubtitle: "è¯·é€‰æ‹©æ‚¨åå¥½çš„è¯­è¨€ç»§ç»­",
      loginTitle: "ç™»å½•",
      signupTitle: "åˆ›å»ºè´¦æˆ·",
      btnLoginText: "ç™»å½•",
      createAccountText: "åˆ›å»ºè´¦æˆ·",
      confirmText: "ç¡®è®¤",
      backToLoginText: "è¿”å›ç™»å½•",
      welcomeUserTitle: "æ¬¢è¿",
      readyText: "å‡†å¤‡å°±ç»ª",
      signoutText: "é€€å‡ºç™»å½•",
      loginFooter: "åœ¨ä¸Šæ–¹é€‰æ‹©å…¶ä»–è¯­è¨€",
      emailPlaceholder: "ç”µå­é‚®ä»¶",
      passwordPlaceholder: "å¯†ç ",
      namePlaceholder: "å§“å",
      agePlaceholder: "å¹´é¾„",
      phonePlaceholder: "ç”µè¯ (å¯é€‰)",
      selectGender: "é€‰æ‹©æ€§åˆ«",
      male: "ç”·æ€§",
      female: "å¥³æ€§",
      other: "å…¶ä»–",
      statusReady: "å‡†å¤‡å°±ç»ª",
      statusLoginSuccess: "ç™»å½•æˆåŠŸ",
      statusSignupSuccess: "è´¦æˆ·åˆ›å»ºæˆåŠŸ",
      statusLoggingIn: "ç™»å½•ä¸­...",
      statusCreatingAccount: "åˆ›å»ºè´¦æˆ·ä¸­...",
      statusSigningOut: "é€€å‡ºç™»å½•ä¸­...",
      statusSignedOut: "å·²é€€å‡ºç™»å½•",
      statusEnterCredentials: "è¯·è¾“å…¥ç”µå­é‚®ä»¶å’Œå¯†ç ",
      statusFillRequired: "è¯·å¡«å†™å§“åã€ç”µå­é‚®ä»¶å’Œå¯†ç  (æœ€å°‘6ä½)",
      statusAuthError: "è®¤è¯é”™è¯¯"
    },
    mm: {
      welcomeTitle: "Awvtsaab's æ¼†æ›¸ á€™á€¾á€€á€¼á€­á€¯á€†á€­á€¯á€•á€«á€á€šá€º",
      welcomeSubtitle: "á€€á€»á€±á€¸á€‡á€°á€¸á€•á€¼á€¯á á€†á€€á€ºá€œá€€á€ºá€›á€”á€º á€á€„á€·á€ºá€”á€¾á€…á€ºá€á€€á€ºá€›á€¬á€˜á€¬á€á€¬á€…á€€á€¬á€¸á€€á€­á€¯ á€›á€½á€±á€¸á€á€»á€šá€ºá€•á€«",
      loginTitle: "á€œá€±á€¬á€·á€‚á€ºá€¡á€„á€º",
      signupTitle: "á€¡á€€á€±á€¬á€„á€·á€ºá€–á€”á€ºá€á€®á€¸á€›á€”á€º",
      btnLoginText: "á€œá€±á€¬á€·á€‚á€ºá€¡á€„á€º",
      createAccountText: "á€¡á€€á€±á€¬á€„á€·á€ºá€–á€”á€ºá€á€®á€¸á€›á€”á€º",
      confirmText: "á€¡á€á€Šá€ºá€•á€¼á€¯á€›á€”á€º",
      backToLoginText: "á€œá€±á€¬á€·á€‚á€ºá€¡á€„á€ºá€á€­á€¯á€· á€•á€¼á€”á€ºá€á€½á€¬á€¸á€›á€”á€º",
      welcomeUserTitle: "á€€á€¼á€­á€¯á€†á€­á€¯á€•á€«á€á€šá€º",
      readyText: "á€¡á€†á€„á€ºá€á€„á€·á€º",
      signoutText: "á€‘á€½á€€á€ºá€›á€”á€º",
      loginFooter: "á€¡á€‘á€€á€ºá€á€½á€„á€º á€¡á€á€¼á€¬á€¸á€˜á€¬á€á€¬á€…á€€á€¬á€¸á€€á€­á€¯ á€›á€½á€±á€¸á€á€»á€šá€ºá€•á€«",
      emailPlaceholder: "á€¡á€®á€¸á€™á€±á€¸á€œá€º",
      passwordPlaceholder: "á€…á€€á€¬á€¸á€á€¾á€€á€º",
      namePlaceholder: "á€¡á€™á€Šá€º",
      agePlaceholder: "á€¡á€á€€á€º",
      phonePlaceholder: "á€–á€¯á€”á€ºá€¸á€”á€¶á€•á€«á€á€º (á€á€»á€”á€ºá€œá€¾á€•á€ºá€‘á€¬á€¸á€”á€­á€¯á€„á€ºá€á€Šá€º)",
      selectGender: "á€œá€­á€„á€º á€›á€½á€±á€¸á€á€»á€šá€ºá€•á€«",
      male: "á€€á€»á€¬á€¸",
      female: "á€™",
      other: "á€¡á€á€¼á€¬á€¸",
      statusReady: "á€¡á€†á€„á€ºá€á€„á€·á€º",
      statusLoginSuccess: "á€œá€±á€¬á€·á€‚á€ºá€¡á€„á€ºá€¡á€±á€¬á€„á€ºá€™á€¼á€„á€ºá€•á€«á€á€Šá€º",
      statusSignupSuccess: "á€¡á€€á€±á€¬á€„á€·á€ºá€–á€”á€ºá€á€®á€¸á€á€¼á€„á€ºá€¸á€¡á€±á€¬á€„á€ºá€™á€¼á€„á€ºá€•á€«á€á€Šá€º",
      statusLoggingIn: "á€œá€±á€¬á€·á€‚á€ºá€¡á€„á€ºá€á€„á€ºá€”á€±á€•á€«á€á€Šá€º...",
      statusCreatingAccount: "á€¡á€€á€±á€¬á€„á€·á€ºá€–á€”á€ºá€á€®á€¸á€”á€±á€•á€«á€á€Šá€º...",
      statusSigningOut: "á€‘á€½á€€á€ºá€”á€±á€•á€«á€á€Šá€º...",
      statusSignedOut: "á€‘á€½á€€á€ºá€•á€¼á€®á€¸á€•á€«á€•á€¼á€®",
      statusEnterCredentials: "á€€á€»á€±á€¸á€‡á€°á€¸á€•á€¼á€¯á á€¡á€®á€¸á€™á€±á€¸á€œá€ºá€”á€¾á€„á€·á€º á€…á€€á€¬á€¸á€á€¾á€€á€ºá€€á€­á€¯á€‘á€Šá€·á€ºá€•á€«",
      statusFillRequired: "á€€á€»á€±á€¸á€‡á€°á€¸á€•á€¼á€¯á á€¡á€™á€Šá€ºáŠ á€¡á€®á€¸á€™á€±á€¸á€œá€ºá€”á€¾á€„á€·á€º á€…á€€á€¬á€¸á€á€¾á€€á€º (á€¡á€”á€Šá€ºá€¸á€†á€¯á€¶á€¸ á† á€œá€¯á€¶á€¸) á€€á€­á€¯á€–á€¼á€Šá€·á€ºá€•á€«",
      statusAuthError: "á€á€½á€„á€·á€ºá€•á€¼á€¯á€á€»á€€á€ºá€¡á€™á€¾á€¬á€¸"
    }
  };

  // åº”ç”¨è¯­è¨€ç¿»è¯‘
  function applyTranslations(lang) {
    const t = translations[lang] || translations.en;
    
    // æ›´æ–°æ‰€æœ‰æ–‡æœ¬å…ƒç´ 
    document.getElementById('welcomeTitle').textContent = t.welcomeTitle;
    document.getElementById('welcomeSubtitle').textContent = t.welcomeSubtitle;
    document.getElementById('loginTitle').textContent = t.loginTitle;
    document.getElementById('signupTitle').textContent = t.signupTitle;
    document.getElementById('btnLoginText').textContent = t.btnLoginText;
    document.getElementById('createAccountText').textContent = t.createAccountText;
    document.getElementById('confirmText').textContent = t.confirmText;
    document.getElementById('backToLoginText').textContent = t.backToLoginText;
    document.getElementById('welcomeUserTitle').textContent = t.welcomeUserTitle;
    document.getElementById('readyText').textContent = t.readyText;
    document.getElementById('signoutText').textContent = t.signoutText;
    document.getElementById('loginFooter').textContent = t.loginFooter;
    
    // æ›´æ–°è¾“å…¥æ¡†å ä½ç¬¦
    document.getElementById('loginEmail').placeholder = t.emailPlaceholder;
    document.getElementById('loginPassword').placeholder = t.passwordPlaceholder;
    document.getElementById('signupName').placeholder = t.namePlaceholder;
    document.getElementById('signupEmail').placeholder = t.emailPlaceholder;
    document.getElementById('signupPassword').placeholder = t.passwordPlaceholder + " (min 6)";
    document.getElementById('signupAge').placeholder = t.agePlaceholder;
    document.getElementById('signupPhone').placeholder = t.phonePlaceholder;
    
    // æ›´æ–°é€‰æ‹©æ¡†é€‰é¡¹
    const genderSelect = document.getElementById('signupGender');
    genderSelect.options[0].text = t.selectGender;
    genderSelect.options[1].text = t.male;
    genderSelect.options[2].text = t.female;
    genderSelect.options[3].text = t.other;
    
    // æ›´æ–°çŠ¶æ€ä¿¡æ¯
    if (document.getElementById('statusBox').textContent === 'Ready') {
      setStatus(t.statusReady, null);
    }
  }

  // åˆ‡æ¢è¯­è¨€
  function changeLanguage(lang) {
    currentLang = lang;
    localStorage.setItem('preferredLang', lang);
    
    // æ›´æ–°æŒ‰é’®æ¿€æ´»çŠ¶æ€
    document.querySelectorAll('.lang-btn').forEach(btn => {
      btn.classList.toggle('active', btn.dataset.lang === lang);
    });
    
    // åº”ç”¨ç¿»è¯‘
    applyTranslations(lang);
    
    // å¦‚æœå½“å‰åœ¨æ¬¢è¿é¡µé¢ï¼Œåˆ‡æ¢åˆ°ç™»å½•é¡µé¢
    if (!document.getElementById('welcomeView').classList.contains('hidden')) {
      showLogin();
    }
  }

  // åˆå§‹åŒ–è¯­è¨€
  function initLanguage() {
    // è®¾ç½®åˆå§‹è¯­è¨€æŒ‰é’®çŠ¶æ€
    document.querySelectorAll('.lang-btn').forEach(btn => {
      btn.classList.toggle('active', btn.dataset.lang === currentLang);
      btn.addEventListener('click', () => changeLanguage(btn.dataset.lang));
    });
    
    // åº”ç”¨åˆå§‹è¯­è¨€
    applyTranslations(currentLang);
  }

  // ---------- UI helpers ----------
  const statusBox = document.getElementById('statusBox');
  function setStatus(msg, type) {
    statusBox.className = 'status';
    if (type === 'success') { statusBox.classList.add('success'); }
    else if (type === 'error') { statusBox.classList.add('error'); }
    else { /* neutral */ }
    statusBox.textContent = msg;
  }

  function showWelcome() {
    document.getElementById('welcomeView').classList.remove('hidden');
    document.getElementById('authViews').classList.add('hidden');
    document.getElementById('userView').classList.add('hidden');
  }

  function showLogin() {
    document.getElementById('welcomeView').classList.add('hidden');
    document.getElementById('authViews').classList.remove('hidden');
    document.getElementById('loginView').classList.remove('hidden');
    document.getElementById('signupView').classList.add('hidden');
    document.getElementById('userView').classList.add('hidden');
  }

  function showSignup() {
    document.getElementById('welcomeView').classList.add('hidden');
    document.getElementById('authViews').classList.remove('hidden');
    document.getElementById('loginView').classList.add('hidden');
    document.getElementById('signupView').classList.remove('hidden');
    document.getElementById('userView').classList.add('hidden');
  }

  // ---------- Auth logic ----------
  async function signup(){
    const t = translations[currentLang];
    const name = document.getElementById('signupName').value.trim();
    const email = document.getElementById('signupEmail').value.trim();
    const password = document.getElementById('signupPassword').value;
    const age = document.getElementById('signupAge').value;
    const gender = document.getElementById('signupGender').value;
    const phone = document.getElementById('signupPhone').value.trim();

    if (!name || !email || password.length < 6) {
      setStatus(t.statusFillRequired, 'error'); return;
    }

    setStatus(t.statusCreatingAccount, null);
    try {
      const userCredential = await auth.createUserWithEmailAndPassword(email, password);
      const uid = userCredential.user.uid;

      // Save profile to Realtime Database
      const profile = {
        name,
        email,
        age: age? Number(age) : null,
        gender: gender || null,
        phone: phone || null,
        preferredLang: currentLang,
        createdAt: firebase.database.ServerValue.TIMESTAMP
      };

      await db.ref('users/' + uid).set(profile);

      setStatus(t.statusSignupSuccess, 'success');

      // Optionally send email verification
      // await userCredential.user.sendEmailVerification();
    } catch (err) {
      console.error(err);
      setStatus(t.statusAuthError + ': ' + (err.message || err), 'error');
    }
  }

  async function login() {
    const t = translations[currentLang];
    const email = document.getElementById('loginEmail').value.trim();
    const password = document.getElementById('loginPassword').value;
    if (!email || !password) { 
      setStatus(t.statusEnterCredentials, 'error'); 
      return; 
    }

    setStatus(t.statusLoggingIn, null);
    try {
      const userCredential = await auth.signInWithEmailAndPassword(email, password);
      setStatus(t.statusLoginSuccess, 'success');

      // ğŸ”‘ Redirect to home.html after login
      window.location.href = 'home.html';
    } catch (err) {
      console.error(err);
      setStatus(t.statusAuthError + ': ' + (err.message || err), 'error');
    }
  }

  function signout(){
    const t = translations[currentLang];
    setStatus(t.statusSigningOut, null);
    auth.signOut().then(()=>{ 
      setStatus(t.statusSignedOut, null); 
      showWelcome();
    }).catch(err=>{
      setStatus(t.statusAuthError + ': ' + err.message, 'error');
    });
  }

  function continueToApp() {
    window.location.href = 'home.html';
  }

  // ---------- Presence (Realtime) ----------
  function setUserPresence(user) {
    if (!user) return;
    const uid = user.uid;
    const userStatusRef = db.ref('/status/' + uid);

    const isOfflineForDatabase = {
      state: 'offline',
      last_changed: firebase.database.ServerValue.TIMESTAMP
    };
    const isOnlineForDatabase = {
      state: 'online',
      last_changed: firebase.database.ServerValue.TIMESTAMP
    };

    const connectedRef = db.ref('.info/connected');
    connectedRef.on('value', snap => {
      if (snap.val() === true) {
        userStatusRef.onDisconnect().set(isOfflineForDatabase).then(() => {
          userStatusRef.set(isOnlineForDatabase);
        });
      }
    });
  }

  // ---------- Auth state listener ----------
  auth.onAuthStateChanged(async user => {
    if (user) {
      // Show user view
      document.getElementById('welcomeView').classList.add('hidden');
      document.getElementById('authViews').classList.add('hidden');
      document.getElementById('userView').classList.remove('hidden');

      const t = translations[currentLang];
      setStatus(t.statusReady, null);

      // load profile from DB
      const profileSnap = await db.ref('users/' + user.uid).once('value');
      const profile = profileSnap.val() || {};
      document.getElementById('welcomeUserTitle').textContent = `${t.welcomeUserTitle}, ${profile.name || (user.email || 'User')}`;
      document.getElementById('userInfo').textContent = `Email: ${user.email}  Â·  Age: ${profile.age || 'â€”'}  Â·  Gender: ${profile.gender || 'â€”'}`;

      // Set presence
      setUserPresence(user);

      // Listen to presence changes for this user and show them
      const presRef = db.ref('status/' + user.uid);
      presRef.on('value', snap => {
        const v = snap.val();
        document.getElementById('presenceText').textContent = v ? v.state + ' (updated ' + (v.last_changed ? new Date(v.last_changed).toLocaleString() : 'â€”') + ')' : 'â€”';
      });

      setStatus(t.statusReady, 'success');
    } else {
      // Not logged in: show welcome page
      document.getElementById('userView').classList.add('hidden');
      document.getElementById('authViews').classList.add('hidden');
      document.getElementById('welcomeView').classList.remove('hidden');
      
      const t = translations[currentLang];
      setStatus(t.statusReady, null);
      document.getElementById('presenceText').textContent = 'â€”';
    }
  });

  // åˆå§‹åŒ–é¡µé¢
  window.addEventListener('load', () => {
    initLanguage();
    initVideo();
  });

  </script>
</body>
</html>
