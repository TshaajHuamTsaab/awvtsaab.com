<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>网站管理系统</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @font-face {
            font-family: 'MyCustomFont';
            src: url('./fonts/MyCustomFont.woff2') format('woff2'),
                 url('./fonts/MyCustomFont.woff') format('woff');
            font-weight: normal;
            font-style: normal;
        }
        
        body {
            font-family: 'MyCustomFont', sans-serif;
        }
        
        /* 自定义滚动条 */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
        
        /* 动画效果 */
        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* 标签页样式 */
        .tab-active {
            border-bottom: 2px solid #3b82f6;
            color: #3b82f6;
        }
        
        /* 模态框样式 */
        .modal-overlay {
            background-color: rgba(0, 0, 0, 0.5);
        }
    </style>
</head>
<body class="bg-gray-100">
    <!-- 导航栏 -->
    <nav class="bg-white shadow-md">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <a href="index.html" class="flex-shrink-0 flex items-center">
                        <img class="h-8 w-8" src="./assets/images/logo.png" alt="Logo">
                        <span class="ml-2 text-xl font-bold">网站管理系统</span>
                    </a>
                    <div class="hidden md:ml-6 md:flex md:space-x-4">
                        <a href="index.html" class="px-3 py-2 rounded-md text-sm font-medium text-gray-900 bg-gray-200">首页</a>
                        <a href="profile.html" class="px-3 py-2 rounded-md text-sm font-medium text-gray-700 hover:text-gray-900 hover:bg-gray-200">个人资料</a>
                        <a href="settings.html" class="px-3 py-2 rounded-md text-sm font-medium text-gray-700 hover:text-gray-900 hover:bg-gray-200">设置</a>
                        <a href="admin/dashboard.html" class="px-3 py-2 rounded-md text-sm font-medium text-gray-700 hover:text-gray-900 hover:bg-gray-200">管理面板</a>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <button id="loginBtn" class="relative inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                            登录
                        </button>
                    </div>
                    <div class="ml-3 relative" id="userMenu" style="display: none;">
                        <div>
                            <button id="userMenuButton" class="max-w-xs bg-white flex items-center text-sm rounded-full focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                                <span class="sr-only">打开用户菜单</span>
                                <img id="userAvatar" class="h-8 w-8 rounded-full" src="./assets/images/user-avatar.png" alt="用户头像">
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- 主要内容区域 -->
    <main class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
        <!-- 页面内容将在这里动态加载 -->
        <div id="page-content" class="px-4 py-6 sm:px-0">
            <!-- 默认显示首页内容 -->
            <div class="bg-white overflow-hidden shadow rounded-lg">
                <div class="px-4 py-5 sm:p-6">
                    <h1 class="text-3xl font-bold text-gray-900 mb-4">欢迎来到网站管理系统</h1>
                    <p class="text-gray-600 mb-6">这是一个功能完整的网站管理系统，包含用户资料、设置和管理员功能。</p>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="bg-blue-50 p-4 rounded-lg">
                            <h2 class="text-xl font-semibold text-blue-800 mb-2">用户资料</h2>
                            <p class="text-blue-600">管理您的个人信息、头像和偏好设置。</p>
                            <a href="profile.html" class="mt-3 inline-block text-blue-700 hover:text-blue-900 font-medium">前往资料页 →</a>
                        </div>
                        
                        <div class="bg-green-50 p-4 rounded-lg">
                            <h2 class="text-xl font-semibold text-green-800 mb-2">系统设置</h2>
                            <p class="text-green-600">自定义网站外观、通知和其他偏好设置。</p>
                            <a href="settings.html" class="mt-3 inline-block text-green-700 hover:text-green-900 font-medium">前往设置页 →</a>
                        </div>
                        
                        <div class="bg-purple-50 p-4 rounded-lg">
                            <h2 class="text-xl font-semibold text-purple-800 mb-2">管理面板</h2>
                            <p class="text-purple-600">管理员专用区域，管理用户、备份和数据。</p>
                            <a href="admin/dashboard.html" class="mt-3 inline-block text-purple-700 hover:text-purple-900 font-medium">前往管理面板 →</a>
                        </div>
                    </div>
                    
                    <div class="mt-8">
                        <h2 class="text-2xl font-bold text-gray-900 mb-4">快速开始</h2>
                        <ol class="list-decimal list-inside space-y-2 text-gray-600">
                            <li>点击右上角的"登录"按钮模拟登录</li>
                            <li>访问"个人资料"页面管理您的信息</li>
                            <li>在"设置"页面中自定义您的偏好</li>
                            <li>如果您是管理员，可以访问"管理面板"</li>
                        </ol>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- 登录模态框 -->
    <div id="loginModal" class="fixed inset-0 overflow-y-auto z-50 modal-overlay" style="display: none;">
        <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 transition-opacity" aria-hidden="true">
                <div class="absolute inset-0 bg-gray-500 opacity-75"></div>
            </div>

            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>

            <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
                <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <div class="sm:flex sm:items-start">
                        <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left w-full">
                            <h3 class="text-lg leading-6 font-medium text-gray-900" id="modal-title">
                                登录到您的账户
                            </h3>
                            <div class="mt-4">
                                <form id="loginForm">
                                    <div class="mb-4">
                                        <label for="username" class="block text-sm font-medium text-gray-700">用户名</label>
                                        <input type="text" id="username" name="username" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                                    </div>
                                    <div class="mb-4">
                                        <label for="password" class="block text-sm font-medium text-gray-700">密码</label>
                                        <input type="password" id="password" name="password" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                                    </div>
                                    <div class="mb-4">
                                        <label class="inline-flex items-center">
                                            <input type="checkbox" class="rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50">
                                            <span class="ml-2 text-sm text-gray-600">记住我</span>
                                        </label>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                    <button type="button" id="confirmLogin" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:ml-3 sm:w-auto sm:text-sm">
                        登录
                    </button>
                    <button type="button" id="cancelLogin" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
                        取消
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 通用模态框 -->
    <div id="generalModal" class="fixed inset-0 overflow-y-auto z-50 modal-overlay" style="display: none;">
        <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 transition-opacity" aria-hidden="true">
                <div class="absolute inset-0 bg-gray-500 opacity-75"></div>
            </div>

            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>

            <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
                <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <div class="sm:flex sm:items-start">
                        <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left w-full">
                            <h3 class="text-lg leading-6 font-medium text-gray-900" id="modalTitle">
                                模态框标题
                            </h3>
                            <div class="mt-2">
                                <p class="text-sm text-gray-500" id="modalContent">
                                    模态框内容将在这里显示。
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                    <button type="button" id="confirmModal" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:ml-3 sm:w-auto sm:text-sm">
                        确认
                    </button>
                    <button type="button" id="cancelModal" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
                        取消
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 用户数据管理
        const UserManager = {
            currentUser: null,
            
            init: function() {
                // 从本地存储加载用户数据
                this.loadUsers();
                this.checkLoginStatus();
            },
            
            loadUsers: function() {
                // 尝试从本地存储加载用户数据
                const storedUsers = localStorage.getItem('websiteUsers');
                if (storedUsers) {
                    this.users = JSON.parse(storedUsers);
                } else {
                    // 创建默认用户数据
                    this.users = [
                        {
                            id: 1,
                            username: 'admin',
                            password: 'admin123',
                            email: 'admin@example.com',
                            role: 'admin',
                            avatar: './assets/images/user-avatar.png',
                            profile: {
                                fullName: '管理员',
                                bio: '系统管理员',
                                location: '北京',
                                website: 'https://example.com'
                            },
                            settings: {
                                theme: 'light',
                                notifications: true,
                                language: 'zh-CN'
                            }
                        },
                        {
                            id: 2,
                            username: 'user',
                            password: 'user123',
                            email: 'user@example.com',
                            role: 'user',
                            avatar: './assets/images/user-avatar.png',
                            profile: {
                                fullName: '普通用户',
                                bio: '这是一个普通用户',
                                location: '上海',
                                website: ''
                            },
                            settings: {
                                theme: 'light',
                                notifications: true,
                                language: 'zh-CN'
                            }
                        }
                    ];
                    this.saveUsers();
                }
            },
            
            saveUsers: function() {
                localStorage.setItem('websiteUsers', JSON.stringify(this.users));
            },
            
            login: function(username, password) {
                const user = this.users.find(u => u.username === username && u.password === password);
                if (user) {
                    this.currentUser = user;
                    localStorage.setItem('currentUser', JSON.stringify(user));
                    return true;
                }
                return false;
            },
            
            logout: function() {
                this.currentUser = null;
                localStorage.removeItem('currentUser');
            },
            
            checkLoginStatus: function() {
                const storedUser = localStorage.getItem('currentUser');
                if (storedUser) {
                    this.currentUser = JSON.parse(storedUser);
                    this.updateUI();
                }
            },
            
            updateUI: function() {
                const loginBtn = document.getElementById('loginBtn');
                const userMenu = document.getElementById('userMenu');
                const userAvatar = document.getElementById('userAvatar');
                
                if (this.currentUser) {
                    loginBtn.style.display = 'none';
                    userMenu.style.display = 'block';
                    userAvatar.src = this.currentUser.avatar;
                } else {
                    loginBtn.style.display = 'block';
                    userMenu.style.display = 'none';
                }
            },
            
            updateUser: function(userData) {
                const userIndex = this.users.findIndex(u => u.id === this.currentUser.id);
                if (userIndex !== -1) {
                    this.users[userIndex] = {...this.users[userIndex], ...userData};
                    this.currentUser = this.users[userIndex];
                    localStorage.setItem('currentUser', JSON.stringify(this.currentUser));
                    this.saveUsers();
                    return true;
                }
                return false;
            },
            
            getAllUsers: function() {
                return this.users;
            },
            
            createUser: function(userData) {
                const newId = Math.max(...this.users.map(u => u.id)) + 1;
                const newUser = {
                    id: newId,
                    ...userData
                };
                this.users.push(newUser);
                this.saveUsers();
                return newUser;
            },
            
            deleteUser: function(userId) {
                const userIndex = this.users.findIndex(u => u.id === userId);
                if (userIndex !== -1 && this.users[userIndex].role !== 'admin') {
                    this.users.splice(userIndex, 1);
                    this.saveUsers();
                    return true;
                }
                return false;
            }
        };

        // 模态框管理
        const ModalManager = {
            showLoginModal: function() {
                document.getElementById('loginModal').style.display = 'block';
            },
            
            hideLoginModal: function() {
                document.getElementById('loginModal').style.display = 'none';
            },
            
            showGeneralModal: function(title, content, confirmCallback = null) {
                document.getElementById('modalTitle').textContent = title;
                document.getElementById('modalContent').textContent = content;
                document.getElementById('generalModal').style.display = 'block';
                
                // 设置确认按钮回调
                const confirmBtn = document.getElementById('confirmModal');
                confirmBtn.onclick = () => {
                    if (confirmCallback) confirmCallback();
                    this.hideGeneralModal();
                };
            },
            
            hideGeneralModal: function() {
                document.getElementById('generalModal').style.display = 'none';
            }
        };

        // 页面路由管理
        const PageManager = {
            currentPage: 'index.html',
            
            init: function() {
                this.setupNavigation();
                this.loadPageContent();
            },
            
            setupNavigation: function() {
                // 为所有导航链接添加点击事件
                document.querySelectorAll('nav a').forEach(link => {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        const href = link.getAttribute('href');
                        this.navigateTo(href);
                    });
                });
            },
            
            navigateTo: function(page) {
                this.currentPage = page;
                history.pushState(null, '', page);
                this.loadPageContent();
            },
            
            loadPageContent: function() {
                const contentArea = document.getElementById('page-content');
                
                // 根据当前页面加载相应内容
                switch(this.currentPage) {
                    case 'index.html':
                        this.loadHomePage(contentArea);
                        break;
                    case 'profile.html':
                        this.loadProfilePage(contentArea);
                        break;
                    case 'settings.html':
                        this.loadSettingsPage(contentArea);
                        break;
                    case 'admin/dashboard.html':
                        this.loadAdminDashboard(contentArea);
                        break;
                    case 'admin/backup.html':
                        this.loadAdminBackup(contentArea);
                        break;
                    case 'admin/users.html':
                        this.loadAdminUsers(contentArea);
                        break;
                    default:
                        this.loadHomePage(contentArea);
                }
            },
            
            loadHomePage: function(container) {
                container.innerHTML = `
                    <div class="bg-white overflow-hidden shadow rounded-lg">
                        <div class="px-4 py-5 sm:p-6">
                            <h1 class="text-3xl font-bold text-gray-900 mb-4">欢迎来到网站管理系统</h1>
                            <p class="text-gray-600 mb-6">这是一个功能完整的网站管理系统，包含用户资料、设置和管理员功能。</p>
                            
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div class="bg-blue-50 p-4 rounded-lg">
                                    <h2 class="text-xl font-semibold text-blue-800 mb-2">用户资料</h2>
                                    <p class="text-blue-600">管理您的个人信息、头像和偏好设置。</p>
                                    <a href="profile.html" class="mt-3 inline-block text-blue-700 hover:text-blue-900 font-medium">前往资料页 →</a>
                                </div>
                                
                                <div class="bg-green-50 p-4 rounded-lg">
                                    <h2 class="text-xl font-semibold text-green-800 mb-2">系统设置</h2>
                                    <p class="text-green-600">自定义网站外观、通知和其他偏好设置。</p>
                                    <a href="settings.html" class="mt-3 inline-block text-green-700 hover:text-green-900 font-medium">前往设置页 →</a>
                                </div>
                                
                                <div class="bg-purple-50 p-4 rounded-lg">
                                    <h2 class="text-xl font-semibold text-purple-800 mb-2">管理面板</h2>
                                    <p class="text-purple-600">管理员专用区域，管理用户、备份和数据。</p>
                                    <a href="admin/dashboard.html" class="mt-3 inline-block text-purple-700 hover:text-purple-900 font-medium">前往管理面板 →</a>
                                </div>
                            </div>
                            
                            <div class="mt-8">
                                <h2 class="text-2xl font-bold text-gray-900 mb-4">快速开始</h2>
                                <ol class="list-decimal list-inside space-y-2 text-gray-600">
                                    <li>点击右上角的"登录"按钮模拟登录</li>
                                    <li>访问"个人资料"页面管理您的信息</li>
                                    <li>在"设置"页面中自定义您的偏好</li>
                                    <li>如果您是管理员，可以访问"管理面板"</li>
                                </ol>
                            </div>
                        </div>
                    </div>
                `;
                
                // 重新绑定事件
                this.setupNavigation();
            },
            
            loadProfilePage: function(container) {
                if (!UserManager.currentUser) {
                    container.innerHTML = `
                        <div class="bg-white overflow-hidden shadow rounded-lg">
                            <div class="px-4 py-5 sm:p-6 text-center">
                                <h2 class="text-xl font-semibold text-gray-700">请先登录以查看个人资料</h2>
                                <button id="goToLogin" class="mt-4 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">立即登录</button>
                            </div>
                        </div>
                    `;
                    
                    document.getElementById('goToLogin').addEventListener('click', () => {
                        ModalManager.showLoginModal();
                    });
                    return;
                }
                
                const user = UserManager.currentUser;
                container.innerHTML = `
                    <div class="bg-white overflow-hidden shadow rounded-lg">
                        <div class="px-4 py-5 sm:p-6">
                            <div class="flex flex-col md:flex-row items-start md:items-center mb-6">
                                <div class="flex-shrink-0 mb-4 md:mb-0 md:mr-6">
                                    <img id="profileAvatar" class="h-24 w-24 rounded-full object-cover" src="${user.avatar}" alt="用户头像">
                                    <input type="file" id="avatarUpload" accept="image/*" class="hidden">
                                    <button id="changeAvatarBtn" class="mt-2 w-full text-sm bg-gray-100 hover:bg-gray-200 text-gray-800 py-1 px-2 rounded">更换头像</button>
                                </div>
                                <div>
                                    <h1 class="text-2xl font-bold text-gray-900">${user.profile.fullName}</h1>
                                    <p class="text-gray-600">@${user.username}</p>
                                    <p class="text-gray-500 mt-2">${user.profile.bio}</p>
                                </div>
                            </div>
                            
                            <!-- 标签页导航 -->
                            <div class="border-b border-gray-200">
                                <nav class="-mb-px flex space-x-8">
                                    <button id="profileTab" class="tab-active whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">个人信息</button>
                                    <button id="accountTab" class="whitespace-nowrap py-4 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300">账户设置</button>
                                    <button id="securityTab" class="whitespace-nowrap py-4 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300">安全</button>
                                </nav>
                            </div>
                            
                            <!-- 标签页内容 -->
                            <div id="profileContent" class="mt-6">
                                <!-- 个人信息标签页内容 -->
                                <div id="profileInfo" class="space-y-4">
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700">全名</label>
                                            <input type="text" id="fullName" value="${user.profile.fullName}" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700">用户名</label>
                                            <input type="text" value="${user.username}" disabled class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 bg-gray-100">
                                        </div>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">个人简介</label>
                                        <textarea id="bio" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500" rows="3">${user.profile.bio}</textarea>
                                    </div>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700">位置</label>
                                            <input type="text" id="location" value="${user.profile.location}" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700">网站</label>
                                            <input type="text" id="website" value="${user.profile.website}" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                                        </div>
                                    </div>
                                    <div class="pt-4">
                                        <button id="saveProfile" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">保存更改</button>
                                    </div>
                                </div>
                                
                                <!-- 账户设置标签页内容 -->
                                <div id="accountInfo" class="space-y-4" style="display: none;">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">电子邮件</label>
                                        <input type="email" id="email" value="${user.email}" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">语言</label>
                                        <select id="language" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                                            <option value="zh-CN" ${user.settings.language === 'zh-CN' ? 'selected' : ''}>简体中文</option>
                                            <option value="en-US" ${user.settings.language === 'en-US' ? 'selected' : ''}>English</option>
                                        </select>
                                    </div>
                                    <div class="pt-4">
                                        <button id="saveAccount" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">保存账户设置</button>
                                    </div>
                                </div>
                                
                                <!-- 安全标签页内容 -->
                                <div id="securityInfo" class="space-y-4" style="display: none;">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">当前密码</label>
                                        <input type="password" id="currentPassword" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">新密码</label>
                                        <input type="password" id="newPassword" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">确认新密码</label>
                                        <input type="password" id="confirmPassword" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                                    </div>
                                    <div class="pt-4">
                                        <button id="changePassword" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">更改密码</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                // 绑定标签页切换事件
                this.setupProfileTabs();
                
                // 绑定头像上传事件
                document.getElementById('changeAvatarBtn').addEventListener('click', () => {
                    document.getElementById('avatarUpload').click();
                });
                
                document.getElementById('avatarUpload').addEventListener('change', (e) => {
                    const file = e.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = (event) => {
                            document.getElementById('profileAvatar').src = event.target.result;
                            // 更新用户数据
                            UserManager.updateUser({avatar: event.target.result});
                            UserManager.updateUI();
                        };
                        reader.readAsDataURL(file);
                    }
                });
                
                // 绑定保存事件
                document.getElementById('saveProfile').addEventListener('click', () => {
                    const profileData = {
                        profile: {
                            fullName: document.getElementById('fullName').value,
                            bio: document.getElementById('bio').value,
                            location: document.getElementById('location').value,
                            website: document.getElementById('website').value
                        }
                    };
                    
                    if (UserManager.updateUser(profileData)) {
                        ModalManager.showGeneralModal('成功', '个人信息已更新！');
                    } else {
                        ModalManager.showGeneralModal('错误', '更新个人信息时出错！');
                    }
                });
                
                document.getElementById('saveAccount').addEventListener('click', () => {
                    const accountData = {
                        email: document.getElementById('email').value,
                        settings: {
                            ...user.settings,
                            language: document.getElementById('language').value
                        }
                    };
                    
                    if (UserManager.updateUser(accountData)) {
                        ModalManager.showGeneralModal('成功', '账户设置已更新！');
                    } else {
                        ModalManager.showGeneralModal('错误', '更新账户设置时出错！');
                    }
                });
                
                document.getElementById('changePassword').addEventListener('click', () => {
                    const currentPassword = document.getElementById('currentPassword').value;
                    const newPassword = document.getElementById('newPassword').value;
                    const confirmPassword = document.getElementById('confirmPassword').value;
                    
                    if (currentPassword !== user.password) {
                        ModalManager.showGeneralModal('错误', '当前密码不正确！');
                        return;
                    }
                    
                    if (newPassword !== confirmPassword) {
                        ModalManager.showGeneralModal('错误', '新密码和确认密码不匹配！');
                        return;
                    }
                    
                    if (UserManager.updateUser({password: newPassword})) {
                        ModalManager.showGeneralModal('成功', '密码已成功更改！');
                        document.getElementById('currentPassword').value = '';
                        document.getElementById('newPassword').value = '';
                        document.getElementById('confirmPassword').value = '';
                    } else {
                        ModalManager.showGeneralModal('错误', '更改密码时出错！');
                    }
                });
            },
            
            setupProfileTabs: function() {
                const profileTab = document.getElementById('profileTab');
                const accountTab = document.getElementById('accountTab');
                const securityTab = document.getElementById('securityTab');
                
                const profileInfo = document.getElementById('profileInfo');
                const accountInfo = document.getElementById('accountInfo');
                const securityInfo = document.getElementById('securityInfo');
                
                profileTab.addEventListener('click', () => {
                    this.switchTab(profileTab, profileInfo, [accountTab, securityTab], [accountInfo, securityInfo]);
                });
                
                accountTab.addEventListener('click', () => {
                    this.switchTab(accountTab, accountInfo, [profileTab, securityTab], [profileInfo, securityInfo]);
                });
                
                securityTab.addEventListener('click', () => {
                    this.switchTab(securityTab, securityInfo, [profileTab, accountTab], [profileInfo, accountInfo]);
                });
            },
            
            switchTab: function(activeTab, activeContent, inactiveTabs, inactiveContents) {
                // 激活当前标签页
                activeTab.classList.add('tab-active');
                activeTab.classList.remove('text-gray-500', 'border-transparent');
                activeContent.style.display = 'block';
                
                // 停用其他标签页
                inactiveTabs.forEach(tab => {
                    tab.classList.remove('tab-active');
                    tab.classList.add('text-gray-500', 'border-transparent');
                });
                
                inactiveContents.forEach(content => {
                    content.style.display = 'none';
                });
            },
            
            loadSettingsPage: function(container) {
                if (!UserManager.currentUser) {
                    container.innerHTML = `
                        <div class="bg-white overflow-hidden shadow rounded-lg">
                            <div class="px-4 py-5 sm:p-6 text-center">
                                <h2 class="text-xl font-semibold text-gray-700">请先登录以访问设置</h2>
                                <button id="goToLoginFromSettings" class="mt-4 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">立即登录</button>
                            </div>
                        </div>
                    `;
                    
                    document.getElementById('goToLoginFromSettings').addEventListener('click', () => {
                        ModalManager.showLoginModal();
                    });
                    return;
                }
                
                const user = UserManager.currentUser;
                container.innerHTML = `
                    <div class="bg-white overflow-hidden shadow rounded-lg">
                        <div class="px-4 py-5 sm:p-6">
                            <h1 class="text-2xl font-bold text-gray-900 mb-6">设置</h1>
                            
                            <div class="space-y-6">
                                <!-- 外观设置 -->
                                <div>
                                    <h2 class="text-lg font-medium text-gray-900 mb-4">外观</h2>
                                    <div class="space-y-4">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">主题</label>
                                            <div class="flex space-x-4">
                                                <label class="inline-flex items-center">
                                                    <input type="radio" name="theme" value="light" ${user.settings.theme === 'light' ? 'checked' : ''} class="rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50">
                                                    <span class="ml-2 text-sm text-gray-700">浅色</span>
                                                </label>
                                                <label class="inline-flex items-center">
                                                    <input type="radio" name="theme" value="dark" ${user.settings.theme === 'dark' ? 'checked' : ''} class="rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50">
                                                    <span class="ml-2 text-sm text-gray-700">深色</span>
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- 通知设置 -->
                                <div>
                                    <h2 class="text-lg font-medium text-gray-900 mb-4">通知</h2>
                                    <div class="space-y-4">
                                        <div class="flex items-center justify-between">
                                            <div>
                                                <label class="text-sm font-medium text-gray-700">电子邮件通知</label>
                                                <p class="text-sm text-gray-500">接收关于您账户的重要通知</p>
                                            </div>
                                            <label class="relative inline-flex items-center cursor-pointer">
                                                <input type="checkbox" id="emailNotifications" ${user.settings.notifications ? 'checked' : ''} class="sr-only peer">
                                                <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                            </label>
                                        </div>
                                        <div class="flex items-center justify-between">
                                            <div>
                                                <label class="text-sm font-medium text-gray-700">推送通知</label>
                                                <p class="text-sm text-gray-500">在浏览器中接收推送通知</p>
                                            </div>
                                            <label class="relative inline-flex items-center cursor-pointer">
                                                <input type="checkbox" id="pushNotifications" class="sr-only peer">
                                                <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- 隐私设置 -->
                                <div>
                                    <h2 class="text-lg font-medium text-gray-900 mb-4">隐私</h2>
                                    <div class="space-y-4">
                                        <div class="flex items-center justify-between">
                                            <div>
                                                <label class="text-sm font-medium text-gray-700">公开个人资料</label>
                                                <p class="text-sm text-gray-500">允许其他人查看您的个人资料</p>
                                            </div>
                                            <label class="relative inline-flex items-center cursor-pointer">
                                                <input type="checkbox" id="publicProfile" checked class="sr-only peer">
                                                <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                            </label>
                                        </div>
                                        <div class="flex items-center justify-between">
                                            <div>
                                                <label class="text-sm font-medium text-gray-700">显示电子邮件</label>
                                                <p class="text-sm text-gray-500">在个人资料中显示您的电子邮件地址</p>
                                            </div>
                                            <label class="relative inline-flex items-center cursor-pointer">
                                                <input type="checkbox" id="showEmail" class="sr-only peer">
                                                <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="pt-4">
                                    <button id="saveSettings" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">保存设置</button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                // 绑定保存设置事件
                document.getElementById('saveSettings').addEventListener('click', () => {
                    const theme = document.querySelector('input[name="theme"]:checked').value;
                    const emailNotifications = document.getElementById('emailNotifications').checked;
                    
                    const settingsData = {
                        settings: {
                            theme: theme,
                            notifications: emailNotifications,
                            language: user.settings.language
                        }
                    };
                    
                    if (UserManager.updateUser(settingsData)) {
                        ModalManager.showGeneralModal('成功', '设置已保存！');
                        // 应用主题
                        if (theme === 'dark') {
                            document.body.classList.add('bg-gray-900', 'text-white');
                        } else {
                            document.body.classList.remove('bg-gray-900', 'text-white');
                        }
                    } else {
                        ModalManager.showGeneralModal('错误', '保存设置时出错！');
                    }
                });
            },
            
            loadAdminDashboard: function(container) {
                if (!UserManager.currentUser || UserManager.currentUser.role !== 'admin') {
                    container.innerHTML = `
                        <div class="bg-white overflow-hidden shadow rounded-lg">
                            <div class="px-4 py-5 sm:p-6 text-center">
                                <h2 class="text-xl font-semibold text-gray-700">您没有权限访问管理面板</h2>
                                <p class="text-gray-500 mt-2">只有管理员可以访问此页面。</p>
                            </div>
                        </div>
                    `;
                    return;
                }
                
                const users = UserManager.getAllUsers();
                container.innerHTML = `
                    <div class="bg-white overflow-hidden shadow rounded-lg">
                        <div class="px-4 py-5 sm:p-6">
                            <h1 class="text-2xl font-bold text-gray-900 mb-6">管理仪表板</h1>
                            
                            <!-- 统计卡片 -->
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
                                <div class="bg-blue-50 p-4 rounded-lg">
                                    <h3 class="text-lg font-semibold text-blue-800">用户总数</h3>
                                    <p class="text-3xl font-bold text-blue-600">${users.length}</p>
                                </div>
                                <div class="bg-green-50 p-4 rounded-lg">
                                    <h3 class="text-lg font-semibold text-green-800">管理员</h3>
                                    <p class="text-3xl font-bold text-green-600">${users.filter(u => u.role === 'admin').length}</p>
                                </div>
                                <div class="bg-purple-50 p-4 rounded-lg">
                                    <h3 class="text-lg font-semibold text-purple-800">普通用户</h3>
                                    <p class="text-3xl font-bold text-purple-600">${users.filter(u => u.role === 'user').length}</p>
                                </div>
                            </div>
                            
                            <!-- 快速操作 -->
                            <div class="mb-8">
                                <h2 class="text-xl font-semibold text-gray-900 mb-4">快速操作</h2>
                                <div class="flex flex-wrap gap-4">
                                    <a href="admin/users.html" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">用户管理</a>
                                    <a href="admin/backup.html" class="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700">数据备份</a>
                                    <button id="systemHealth" class="px-4 py-2 bg-yellow-600 text-white rounded-md hover:bg-yellow-700">系统健康</button>
                                    <button id="clearCache" class="px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700">清除缓存</button>
                                </div>
                            </div>
                            
                            <!-- 最近活动 -->
                            <div>
                                <h2 class="text-xl font-semibold text-gray-900 mb-4">最近活动</h2>
                                <div class="bg-gray-50 p-4 rounded-lg">
                                    <ul class="space-y-2">
                                        <li class="flex items-center">
                                            <span class="w-2 h-2 bg-green-500 rounded-full mr-2"></span>
                                            <span class="text-sm text-gray-600">系统运行正常</span>
                                            <span class="ml-auto text-xs text-gray-500">刚刚</span>
                                        </li>
                                        <li class="flex items-center">
                                            <span class="w-2 h-2 bg-blue-500 rounded-full mr-2"></span>
                                            <span class="text-sm text-gray-600">用户 "user" 已登录</span>
                                            <span class="ml-auto text-xs text-gray-500">5分钟前</span>
                                        </li>
                                        <li class="flex items-center">
                                            <span class="w-2 h-2 bg-blue-500 rounded-full mr-2"></span>
                                            <span class="text-sm text-gray-600">用户 "admin" 更新了个人资料</span>
                                            <span class="ml-auto text-xs text-gray-500">10分钟前</span>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                // 绑定快速操作按钮事件
                document.getElementById('systemHealth').addEventListener('click', () => {
                    ModalManager.showGeneralModal('系统健康', '所有系统运行正常，没有检测到问题。');
                });
                
                document.getElementById('clearCache').addEventListener('click', () => {
                    ModalManager.showGeneralModal('缓存已清除', '系统缓存已成功清除。');
                });
            },
            
            loadAdminBackup: function(container) {
                if (!UserManager.currentUser || UserManager.currentUser.role !== 'admin') {
                    container.innerHTML = `
                        <div class="bg-white overflow-hidden shadow rounded-lg">
                            <div class="px-4 py-5 sm:p-6 text-center">
                                <h2 class="text-xl font-semibold text-gray-700">您没有权限访问备份页面</h2>
                                <p class="text-gray-500 mt-2">只有管理员可以访问此页面。</p>
                            </div>
                        </div>
                    `;
                    return;
                }
                
                container.innerHTML = `
                    <div class="bg-white overflow-hidden shadow rounded-lg">
                        <div class="px-4 py-5 sm:p-6">
                            <h1 class="text-2xl font-bold text-gray-900 mb-6">数据备份</h1>
                            
                            <div class="space-y-6">
                                <!-- 创建备份 -->
                                <div>
                                    <h2 class="text-lg font-medium text-gray-900 mb-4">创建备份</h2>
                                    <p class="text-sm text-gray-600 mb-4">创建系统数据的完整备份。</p>
                                    <button id="createBackup" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">立即备份</button>
                                </div>
                                
                                <!-- 备份列表 -->
                                <div>
                                    <h2 class="text-lg font-medium text-gray-900 mb-4">现有备份</h2>
                                    <div class="bg-gray-50 p-4 rounded-lg">
                                        <div class="flex items-center justify-between py-2 border-b border-gray-200">
                                            <div>
                                                <p class="font-medium">2025-10-18.zip</p>
                                                <p class="text-sm text-gray-500">创建于 2025-10-18 15:30</p>
                                            </div>
                                            <div class="flex space-x-2">
                                                <button class="px-3 py-1 bg-green-600 text-white rounded text-sm hover:bg-green-700">下载</button>
                                                <button class="px-3 py-1 bg-red-600 text-white rounded text-sm hover:bg-red-700">删除</button>
                                            </div>
                                        </div>
                                        <div class="flex items-center justify-between py-2">
                                            <div>
                                                <p class="font-medium">2025-10-17.zip</p>
                                                <p class="text-sm text-gray-500">创建于 2025-10-17 09:15</p>
                                            </div>
                                            <div class="flex space-x-2">
                                                <button class="px-3 py-1 bg-green-600 text-white rounded text-sm hover:bg-green-700">下载</button>
                                                <button class="px-3 py-1 bg-red-600 text-white rounded text-sm hover:bg-red-700">删除</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- 恢复备份 -->
                                <div>
                                    <h2 class="text-lg font-medium text-gray-900 mb-4">恢复备份</h2>
                                    <p class="text-sm text-gray-600 mb-4">从现有备份恢复系统数据。</p>
                                    <div class="flex items-center space-x-4">
                                        <select class="border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                                            <option>选择备份文件</option>
                                            <option>2025-10-18.zip</option>
                                            <option>2025-10-17.zip</option>
                                        </select>
                                        <button class="px-4 py-2 bg-yellow-600 text-white rounded-md hover:bg-yellow-700">恢复</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                // 绑定创建备份事件
                document.getElementById('createBackup').addEventListener('click', () => {
                    const currentDate = new Date().toISOString().split('T')[0];
                    ModalManager.showGeneralModal('备份创建成功', `备份文件 ${currentDate}.zip 已成功创建。`);
                });
            },
            
            loadAdminUsers: function(container) {
                if (!UserManager.currentUser || UserManager.currentUser.role !== 'admin') {
                    container.innerHTML = `
                        <div class="bg-white overflow-hidden shadow rounded-lg">
                            <div class="px-4 py-5 sm:p-6 text-center">
                                <h2 class="text-xl font-semibold text-gray-700">您没有权限访问用户管理页面</h2>
                                <p class="text-gray-500 mt-2">只有管理员可以访问此页面。</p>
                            </div>
                        </div>
                    `;
                    return;
                }
                
                const users = UserManager.getAllUsers();
                container.innerHTML = `
                    <div class="bg-white overflow-hidden shadow rounded-lg">
                        <div class="px-4 py-5 sm:p-6">
                            <div class="flex justify-between items-center mb-6">
                                <h1 class="text-2xl font-bold text-gray-900">用户管理</h1>
                                <button id="addUserBtn" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">添加用户</button>
                            </div>
                            
                            <!-- 用户列表 -->
                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">用户</th>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">角色</th>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">状态</th>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">操作</th>
                                        </tr>
                                    </thead>
                                    <tbody class="bg-white divide-y divide-gray-200">
                                        ${users.map(user => `
                                            <tr>
                                                <td class="px-6 py-4 whitespace-nowrap">
                                                    <div class="flex items-center">
                                                        <div class="flex-shrink-0 h-10 w-10">
                                                            <img class="h-10 w-10 rounded-full" src="${user.avatar}" alt="${user.username}">
                                                        </div>
                                                        <div class="ml-4">
                                                            <div class="text-sm font-medium text-gray-900">${user.profile.fullName}</div>
                                                            <div class="text-sm text-gray-500">${user.email}</div>
                                                        </div>
                                                    </div>
                                                </td>
                                                <td class="px-6 py-4 whitespace-nowrap">
                                                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${user.role === 'admin' ? 'bg-purple-100 text-purple-800' : 'bg-green-100 text-green-800'}">
                                                        ${user.role === 'admin' ? '管理员' : '用户'}
                                                    </span>
                                                </td>
                                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">
                                                        活跃
                                                    </span>
                                                </td>
                                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                                    <button class="text-blue-600 hover:text-blue-900 edit-user" data-id="${user.id}">编辑</button>
                                                    ${user.role !== 'admin' ? `<button class="ml-3 text-red-600 hover:text-red-900 delete-user" data-id="${user.id}">删除</button>` : ''}
                                                </td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                `;
                
                // 绑定添加用户事件
                document.getElementById('addUserBtn').addEventListener('click', () => {
                    this.showAddUserModal();
                });
                
                // 绑定编辑用户事件
                document.querySelectorAll('.edit-user').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const userId = parseInt(e.target.getAttribute('data-id'));
                        this.showEditUserModal(userId);
                    });
                });
                
                // 绑定删除用户事件
                document.querySelectorAll('.delete-user').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const userId = parseInt(e.target.getAttribute('data-id'));
                        this.showDeleteUserModal(userId);
                    });
                });
            },
            
            showAddUserModal: function() {
                ModalManager.showGeneralModal('添加用户', '此功能将在完整版本中实现。', () => {
                    // 模拟添加用户
                    const newUser = UserManager.createUser({
                        username: 'newuser',
                        password: 'password123',
                        email: 'newuser@example.com',
                        role: 'user',
                        avatar: './assets/images/user-avatar.png',
                        profile: {
                            fullName: '新用户',
                            bio: '这是一个新用户',
                            location: '',
                            website: ''
                        },
                        settings: {
                            theme: 'light',
                            notifications: true,
                            language: 'zh-CN'
                        }
                    });
                    
                    ModalManager.showGeneralModal('成功', `用户 "${newUser.username}" 已成功创建！`);
                    // 重新加载用户管理页面
                    this.loadAdminUsers(document.getElementById('page-content'));
                });
            },
            
            showEditUserModal: function(userId) {
                ModalManager.showGeneralModal('编辑用户', '此功能将在完整版本中实现。');
            },
            
            showDeleteUserModal: function(userId) {
                const user = UserManager.getAllUsers().find(u => u.id === userId);
                ModalManager.showGeneralModal('删除用户', `确定要删除用户 "${user.username}" 吗？此操作无法撤销。`, () => {
                    if (UserManager.deleteUser(userId)) {
                        ModalManager.showGeneralModal('成功', `用户 "${user.username}" 已成功删除！`);
                        // 重新加载用户管理页面
                        this.loadAdminUsers(document.getElementById('page-content'));
                    } else {
                        ModalManager.showGeneralModal('错误', '删除用户时出错！');
                    }
                });
            }
        };

        // 初始化应用
        document.addEventListener('DOMContentLoaded', function() {
            // 初始化用户管理器
            UserManager.init();
            
            // 初始化页面管理器
            PageManager.init();
            
            // 绑定登录按钮事件
            document.getElementById('loginBtn').addEventListener('click', function() {
                ModalManager.showLoginModal();
            });
            
            // 绑定登录模态框事件
            document.getElementById('confirmLogin').addEventListener('click', function() {
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;
                
                if (UserManager.login(username, password)) {
                    ModalManager.hideLoginModal();
                    UserManager.updateUI();
                    // 重新加载当前页面内容
                    PageManager.loadPageContent();
                    ModalManager.showGeneralModal('登录成功', `欢迎回来，${UserManager.currentUser.profile.fullName}！`);
                } else {
                    ModalManager.showGeneralModal('登录失败', '用户名或密码不正确！');
                }
            });
            
            document.getElementById('cancelLogin').addEventListener('click', function() {
                ModalManager.hideLoginModal();
            });
            
            // 绑定通用模态框事件
            document.getElementById('cancelModal').addEventListener('click', function() {
                ModalManager.hideGeneralModal();
            });
            
            // 绑定用户菜单事件
            document.getElementById('userMenuButton').addEventListener('click', function() {
                ModalManager.showGeneralModal('用户菜单', '此功能将在完整版本中实现。', () => {
                    UserManager.logout();
                    UserManager.updateUI();
                    PageManager.loadPageContent();
                    ModalManager.showGeneralModal('已登出', '您已成功登出系统。');
                });
            });
            
            // 处理浏览器前进/后退按钮
            window.addEventListener('popstate', function() {
                PageManager.loadPageContent();
            });
        });
    </script>
</body>
</html>